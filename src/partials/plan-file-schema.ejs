## Plan File
<% if (typeof mode !== 'undefined' && mode === 'writer') { -%>

### Path Convention

Write the plan to: `$CLAUDE_PROJECT_DIR/.claude/plans/reaper-[semantic-name].md`

Derive the semantic name from the planning request (2-4 words, lowercase, hyphenated).

### Schema

Create the plan file with this structure on first write:

```markdown
# Plan: [Title from input]

## Input
[Original user request - IMMUTABLE after initial write]

## Research
[Codebase research findings - progressively added]

## Strategy
[Selected strategy name, complexity score with breakdown, rationale for strategy choice]

## Work Units
| # | Title | Type | Hours | Parallel | Assignee | Blocked By |
[Table of decomposed work units with details below]

## Dependencies
[Mermaid flowchart showing execution order and blocking relationships]

## Assumptions
[List of assumptions made during planning - with strikethrough for corrected ones]

## Feedback Log
[Append-only user corrections from refinement iterations - timestamped]
```

### Update Rules

| Section | Update Type | Rule |
|---------|-------------|------|
| Input | IMMUTABLE | Never modified after initial write |
| Research | APPEND | New findings added below existing content |
| Strategy | EDIT | Modified when strategy changes based on feedback |
| Work Units | EDIT | Modified based on feedback, use strikethrough for history |
| Dependencies | EDIT | Modified when work unit structure changes |
| Assumptions | EDIT | Strikethrough corrected assumptions, add new ones |
| Feedback Log | APPEND | Each entry timestamped, never delete previous entries |

**Update type definitions:**
- **IMMUTABLE**: Write once, never change. Preserves original context.
- **APPEND**: Add new content below existing. Never delete previous entries.
- **EDIT**: Modify in place. For corrections, use ~~strikethrough~~ to show history.
<% } else { -%>

### Plan File Sections

A plan file at `.claude/plans/reaper-*.md` may contain: Input, Research, Strategy, Work Units, Dependencies, Assumptions, Feedback Log.

### Extraction Priority

When reading a plan file, extract sections in this order of importance:
1. **Work Units** -- the decomposed tasks to execute
2. **Dependencies** -- execution order and blocking relationships
3. **Research** -- codebase context for agent prompts
4. **Strategy** -- selected strategy and complexity rationale
5. **Assumptions** -- constraints and decisions made during planning

### Adapting to Plan Completeness

- **No plan file found**: Run the full workflow (deploy reaper:workflow-planner for analysis)
- **Plan with Research only**: Deploy reaper:workflow-planner with research as input context
- **Plan with Research + Work Units**: Skip planner, extract work units directly
- **Plan with Research + Work Units + Strategy**: Skip planner entirely, use provided strategy
- **Full plan (all sections)**: Skip planning, pass Feedback Log entries as context to coding agents
<% } -%>
