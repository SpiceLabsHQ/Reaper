## TodoWrite Plan Persistence

After obtaining work units, write them to TodoWrite immediately for session persistence and progress tracking.

### Formatting Standard

Each work unit entry follows this format:
```
Step X.Y: descriptive task name [TASK-ID]
```
- **X** = group/stage number (1, 2, 3...)
- **Y** = work unit within group (1, 2, 3...)
- For pre-planned issues, use the **child** task ID (not the parent)

### Mandatory Final Tasks

Always append these after all work unit entries (no task IDs):
- "User review and feedback"
- "Merge to [target branch]"

### Conditional Final Tasks

Append these after the mandatory tasks when conditions are met:
- "Close completed tasks" -- when a task system (Beads or Jira) is detected
- "Clean up shared worktree" -- when using the medium_single_branch strategy (cleanup at completion, not per-unit)
- "Clean up session worktrees" -- when using the large_multi_worktree strategy (per-unit cleanup, once per worktree teardown)

### Example Output

```
- Step 1.1: Create shared EJS partials [reaper-3gv.1]
- Step 2.1: Refactor takeoff template [reaper-3gv.2]
- Step 2.2: Refactor flight-plan template [reaper-3gv.3]
- User review and feedback
- Merge to develop
- Close completed tasks
```

### Re-Read Protocol

After marking any entry as completed via TodoWrite, immediately use **TaskList** to re-read all entries. This confirms the update was applied and identifies the next pending entry. Do not rely on memory for TodoWrite state -- always re-read after writes.

### Dependency Chain

After creating all TodoWrite entries, set up blockedBy relationships for the final tasks:

- "User review and feedback" is blockedBy every work unit entry (all Step X.Y tasks)
- "Merge to [target branch]" is blockedBy "User review and feedback"
- "Close completed tasks" is blockedBy "Merge to [target branch]"
- "Clean up shared worktree" is blockedBy "Merge to [target branch]" (medium_single_branch only)
- "Clean up session worktrees" is blockedBy "Merge to [target branch]" (large_multi_worktree only)

"Close completed tasks", "Clean up shared worktree", and "Clean up session worktrees" are siblings -- all blocked by Merge, not by each other -- so they run in parallel after merge completes.

### Why Persist to TodoWrite

TodoWrite entries survive session disconnects, give the user real-time visibility into progress, and allow the orchestrator to resume from any point in the plan.
