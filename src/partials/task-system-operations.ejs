## Task System Operations

### Detection

Detect the active task system from recent commit history.

**Output variable:** `TASK_SYSTEM` â€” one of: `Beads`, `Jira`, `GitHub`, `markdown_only`

#### Commit History Pattern Scan

Run `git log --format="%B" -10` and scan commit bodies for issue reference patterns:

| System | Pattern | Examples |
|--------|---------|----------|
| Beads | `(Ref|Closes|Resolves):?\s+[a-z][a-z0-9]*-[a-f0-9]{2,}` | `Ref: reaper-a3f`, `Closes myapp-bc12` |
| Jira | `(Ref|Fixes|Closes|Resolves):?\s+[A-Z]{2,}-\d+` | `Ref: PROJ-123`, `Fixes ENG-456` |
| GitHub Issues | `(Fixes|Closes|Resolves):?\s+#\d+` | `Fixes #456`, `Closes #42` |

**Mixed/ambiguous rule:** If multiple systems match, the system with the highest count wins. Equal counts = `markdown_only`.

#### Fallback Chain

```
Commit patterns found (1+ match in last 10 commits)?
  |-- Yes (single system) --> DONE
  |-- Mixed --> Highest count wins; tie = markdown_only
  +-- No patterns --> markdown_only
```

### Platform Skill Routing

After detection, load the corresponding skill for platform-specific operations:

| TASK_SYSTEM | Skill |
|-------------|-------|
| GitHub | `reaper:issue-tracker-github` |
| Beads | `reaper:issue-tracker-beads` |
| Jira | `reaper:issue-tracker-jira` |
| markdown_only | `reaper:issue-tracker-planfile` |

The loaded skill provides platform-specific command mappings for all abstract operations below.

### Abstract Operations

Use these operations to interact with whatever task system is detected. The LLM maps each operation to the appropriate system commands or markdown equivalents.

| Operation | Purpose |
|-----------|---------|
| FETCH_ISSUE | Retrieve a single issue by ID (title, description, status, acceptance criteria) |
| LIST_CHILDREN | List direct child issues of a parent (one level deep) |
| CREATE_ISSUE | Create a new issue with title, description, and optional `parent` (the `parent` parameter is the sole mechanism for establishing parent-child hierarchy) |
| UPDATE_ISSUE | Modify an existing issue (status, description, assignee) |
| ADD_DEPENDENCY | Create a `blocks` or `related` dependency between two sibling issues (never for hierarchy) |
| QUERY_DEPENDENCY_TREE | Recursively retrieve the full dependency graph from a root issue |
| CLOSE_ISSUE | Mark an issue as completed/closed |

### Dependency Type Semantics

ADD_DEPENDENCY accepts exactly two dependency types: `blocks` and `related`. It creates execution constraints and informational links between sibling issues. It does NOT establish hierarchy -- use CREATE_ISSUE with the `parent` parameter for parent-child relationships.

- **blocks**: Sequential constraint (task A must complete before task B can start)
- **related**: Informational link (tasks share context but no execution dependency)

**Warning:** `parent-child` is NOT a valid dependency type. Never pass `parent-child` to ADD_DEPENDENCY. Hierarchy is established exclusively through the `parent` parameter on CREATE_ISSUE. ADD_DEPENDENCY only connects sibling issues to each other using `blocks` or `related`.
