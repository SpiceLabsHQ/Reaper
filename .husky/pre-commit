# Run unit tests (excludes contract tests â€” those run post-build)
node --test scripts/build.test.js scripts/commitlint.test.js

# Build templates and stage output
npm run build

# Run contract tests on generated output
node --test scripts/contracts.test.js

git add agents/ skills/ hooks/

# Beads pre-commit: flush pending changes to JSONL
if command -v bd >/dev/null 2>&1 && [ -d .beads ]; then
    bd sync --flush-only >/dev/null 2>&1 || {
        echo "Error: Failed to flush bd changes" >&2
        exit 1
    }
    [ -f .beads/issues.jsonl ] && git add .beads/issues.jsonl 2>/dev/null || true
fi
